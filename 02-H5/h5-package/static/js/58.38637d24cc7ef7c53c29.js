webpackJsonp([58],{"0MIV":function(t,o,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=s("fqE/"),e=s("Au9i"),a=s("gyMJ"),n=s("mtWM"),r=s.n(n),c={name:"AddComment",components:{commonHeader:i.a,InfiniteScroll:e.InfiniteScroll,Indicator:e.Indicator,Button:e.Button,Lazyload:e.Lazyload,Toast:e.Toast},data:function(){return{h_title:"提交评价",morePro:!1,proNum:1,wNum:0,pNum:5,fNum:0,orderInfo:[],orderId:"",proInfo:{},procomm:"",tempFilePaths:[],imgs:[],allComm:0,uploadimgList:[],uploadOk:!1,imgShow:!1,img_show_big:"",hiddenUploadImg:!0,showToast:!1,imgPath:"https://share.gongzhugou.com/static/image/xcx_img/"}},mounted:function(){console.log(this.$route.query);var t=this.$route.query;this.proNum=t.num,this.orderId=t.orderId,t.num>1?(this.h_title="评价晒单",this.morePro=!0):(this.h_title="提交评价",this.morePro=!1),console.log(this.orderId),this.getOrder()},methods:{showUpload:function(){this.hiddenUploadImg=!1},hiddenModel:function(){this.hiddenUploadImg=!0},goTop:function(){console.log("回到顶部"),document.getElementById("AddComment").scrollIntoView({block:"start",behavior:"smooth"})},choseStar:function(t,o){"w"===t&&(this.wNum=parseInt(o)+1),"p"===t&&(this.pNum=parseInt(o)+1),"f"===t&&(this.fNum=parseInt(o)+1)},bindTextAreaBlur:function(t){this.procomm=t},getOrder:function(){var t=this,o={id:0,order_id:t.orderId};Object(a._0)(o).then(function(o){o.isSuccess&&null!=o.rows&&(t.proNum>1?(t.allComm=o.rows[0].iscomment,t.orderInfo=o.rows[0].order_items):(t.allComm=o.rows[0].iscomment,t.proInfo=o.rows[0].order_items[0]))})},addComm:function(t){for(var o=0,s=this.orderInfo.length;o<s;o++)t===this.orderInfo[o].product_id&&(this.proInfo=this.orderInfo[o]);this.morePro=!1},addImg:function(){console.log("选择相册");var t=this;document.getElementById("album").onchange=function(o){console.log(o);var s=o.target.files[0];console.log(s),s.size>5242880?Object(e.Toast)({message:"图片必须小于5MB！",duration:1e3}):(t.imgs.push(URL.createObjectURL(s)),t.tempFilePaths.push(s),t.hiddenUploadImg=!0)}},choseCra:function(){var t=this;console.log("选择拍照");var o=window.plus,s=o.camera.getCamera(),i=s.supportedImageResolutions[0],a=s.supportedImageFormats[0];console.log("Resolution: "+i+", Format: "+a),console.log(s),s.captureImage(function(s){console.log(s),o.io.resolveLocalFileSystemURL(s,function(s){var i="_doc/upload/"+s.name;o.zip.compressImage({src:s.toLocalURL(),dst:i,quality:40,overwrite:!0},function(s){console.log(s),o.io.resolveLocalFileSystemURL(s.target,function(s){console.log(s),s.file(function(s){if(console.log(s),s.size>5242880)Object(e.Toast)({message:"图片必须小于5MB！",duration:1e3});else{var i=new o.io.FileReader;i.readAsDataURL(s),i.onloadend=function(o){var i=t.dataURLtoBlob(o.target.result.toString());i.name=s.name,console.log(i),t.imgs.push(o.target.result.toString()),t.tempFilePaths.push(i),t.hiddenUploadImg=!0}}})})},function(t){console.log("压缩图片失败，请稍候再试")})},function(t){console.log("读取拍照文件错误："+t.message)})},function(t){console.log("Capture image failed: "+t.message)},{resolution:i,format:a})},dataURLtoBlob:function(t){for(var o=t.split(","),s=o[0].match(/:(.*?);/)[1],i=atob(o[1].replace(/\s/g,"")),e=i.length,a=new Uint8Array(e);e--;)a[e]=i.charCodeAt(e);return new Blob([a],{type:s})},uploadImg:function(t){var o=this,s=this,i=t.i?t.i:0,n=t.success?t.success:0,c=t.fail?t.fail:0,l=new FormData;l.append("file",t.path[i],t.path[i].name);var m="?m=order&a=imgsave";m="https://share.gongzhugou.com/"+m,console.log("请求上传接口啦"),r.a.post(m,l,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then(function(r){if(console.log(r),r.data.isSuccess?(n++,s.uploadimgList.push(r.data.data[0])):(c++,console.log("fail:"+i+"fail:"+c)),++i===t.path.length){if(console.log("成功："+n+" 失败："+c),s.uploadOk=!0,s.uploadOk){var l={order_id:o.orderId,goods_id:t.id,product_id:t.pid,score:o.pNum,server_score:o.wNum,express_score:o.fNum,goods_comment:o.procomm,file_path:s.uploadimgList.join(",")};Object(a._39)(l).then(function(t){t.isSuccess?(e.Indicator.close(),s.showToast=!1,Object(e.Toast)({message:"评价成功",iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){"0"===s.allComm&&s.proNum>1?(s.morePro=!s.morePro,s.tempFilePaths=[],s.imgs=[],s.pNum=5,s.wNum=0,s.fNum=0,s.getOrder()):s.$router.back()},1e3)):Object(e.Toast)({message:t.msg,duration:1e3})})}}else t.i=i,t.success=n,t.fail=c,s.uploadImg(t)}).catch(function(t){console.log(t),console.log("请求出错")})},delImg:function(t){this.imgs.splice(t,1),this.tempFilePaths.splice(t,1)},previewImg:function(t){!1===this.showToast&&(this.imgShow=!0,this.img_show_big=t)},hiddenImg:function(){this.imgShow=!1},saveCom:function(t,o){if(console.log(this.orderId),console.log(t),console.log(o),console.log(this.procomm),console.log(this.pNum),console.log(this.wNum),console.log(this.fNum),0===this.pNum||0===this.wNum||0===this.fNum)Object(e.Toast)({message:"请对商品进行评分",duration:1e3});else{e.Indicator.open("提交中..."),this.showToast=!0;var s=this;if(s.tempFilePaths.length<=0){var i={order_id:s.orderId,goods_id:t,product_id:o,score:s.pNum,server_score:s.wNum,express_score:s.fNum,goods_comment:s.procomm};Object(a._39)(i).then(function(t){t.isSuccess?(e.Indicator.close(),s.showToast=!1,Object(e.Toast)({message:"感谢您的评价，评价已提交",iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){"0"===s.allComm&&s.proNum>1?(s.morePro=!s.morePro,s.tempFilePaths=[],s.imgs=[],s.wNum=0,s.pNum=5,s.fNum=0,s.getOrder()):s.$router.back()},1e3)):Object(e.Toast)({message:t.msg,duration:1e3})})}else s.uploadImg({path:s.tempFilePaths.slice(0,9),id:t,pid:o})}}}},l={render:function(){var t=this,o=t.$createElement,s=t._self._c||o;return s("div",[s("common-header",{attrs:{h_title:t.h_title,showback:!0}}),t._v(" "),s("return-top",{on:{returnTop:t.goTop}}),t._v(" "),s("div",{staticStyle:{height:"0.9rem"},attrs:{id:"AddComment"}}),t._v(" "),t.morePro?t._e():s("div",{staticClass:"add_com"},[s("div",{staticClass:"addComlist"},[s("div",{staticClass:"comInfo"},[s("div",{staticClass:"comPro"},[s("div",{staticClass:"pro_img"},[s("img",{attrs:{src:t.proInfo.product_img_src}})]),t._v(" "),s("div",{staticClass:"pro_info"},[s("div",{staticClass:"pro_title"},[t._v(t._s(t.proInfo.name))]),t._v(" "),s("div",{staticClass:"pro_spec"},[s("div",{staticClass:"pro_price"},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[t.proInfo.point>0?s("div",{staticClass:"pro_inter_img"},[s("i",{staticClass:"iconfont icon-jifen1"})]):t._e(),t._v(" "),t.proInfo.point>0?s("span",{staticClass:"pro_integral"},[t._v(t._s(t.proInfo.point))]):t._e(),t._v(" "),t.proInfo.point>0&&t.proInfo.price>0?s("span",{staticClass:"pro_integral"},[t._v("+")]):t._e(),t._v(" "),t.proInfo.price>0?s("span",{staticClass:"peo_nowprice"},[t._v("¥"+t._s(t.proInfo.price))]):t._e()])]),t._v(" "),s("div",{staticClass:"pro_weight"},[s("span",[t._v(t._s(t.proInfo.title)+"*"+t._s(t.proInfo.nums))])])])])]),t._v(" "),s("div",{staticClass:"comText"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.procomm,expression:"procomm"}],attrs:{"auto-height":"",placeholder:"商品是否满足您的期待？说说它的优点或美中不足吧","placeholder-class":"phcolor"},domProps:{value:t.procomm},on:{blur:function(o){return t.bindTextAreaBlur(t.procomm)},input:function(o){o.target.composing||(t.procomm=o.target.value)}}}),t._v(" "),s("div",{staticClass:"com_imgList"},[t._l(t.imgs,function(o,i){return s("div",{key:i,staticClass:"imgBlock"},[s("i",{staticClass:"iconfont icon-to-remove",on:{click:function(o){return t.delImg(i)}}}),t._v(" "),s("span"),t._v(" "),s("img",{attrs:{src:o},on:{click:function(s){return t.previewImg(o)}}})])}),t._v(" "),s("div",{staticClass:"hidden_input",on:{click:t.showUpload}},[s("i",{staticClass:"iconfont icon-addpictures addicon",attrs:{hidden:9==t.imgs.length}})])],2)]),t._v(" "),s("div",{staticClass:"comStar"},[t._m(0),t._v(" "),s("div",{staticClass:"starInfo"},[t._m(1),t._v(" "),s("div",{staticClass:"star"},t._l(5,function(o,i){return s("i",{key:i,class:i<t.pNum?"iconfont icon-xingping light":"iconfont icon-star",on:{click:function(o){return t.choseStar("p",i)}}})}),0)]),t._v(" "),s("div",{staticClass:"starInfo"},[t._m(2),t._v(" "),s("div",{staticClass:"star"},t._l(5,function(o,i){return s("i",{key:i,class:i<t.wNum?"iconfont icon-xingping light":"iconfont icon-star",on:{click:function(o){return t.choseStar("w",i)}}})}),0)]),t._v(" "),s("div",{staticClass:"starInfo"},[t._m(3),t._v(" "),s("div",{staticClass:"star"},t._l(5,function(o,i){return s("i",{key:i,class:i<t.fNum?"iconfont icon-xingping light":"iconfont icon-star",on:{click:function(o){return t.choseStar("f",i)}}})}),0)])])]),t._v(" "),s("div",{staticClass:"comBtn"},[s("mt-button",{attrs:{size:"normal",id:"proInfo.goods_id","data-pid":"proInfo.product_id"},on:{click:function(o){return t.saveCom(t.proInfo.goods_id,t.proInfo.product_id)}}},[t._v("完成")])],1)])]),t._v(" "),t.morePro?s("div",{staticClass:"comlist"},[s("div",{staticClass:"addComlist"},[s("div",{staticClass:"comInfo"},t._l(t.orderInfo,function(o,i){return s("div",{key:i,staticClass:"comPro"},[s("div",{staticClass:"pro_img"},[s("img",{attrs:{src:o.product_img_src}})]),t._v(" "),s("div",{staticClass:"pro_info"},[s("div",{staticClass:"pro_title"},[t._v(t._s(o.name))]),t._v(" "),s("div",{staticClass:"pro_spec"},[s("div",{staticClass:"pro_weight"},[s("span",[t._v("规格："+t._s(o.title))]),t._v(" "),s("span",[t._v("数量："+t._s(o.nums))])]),t._v(" "),s("div",{staticClass:"pro_btn"},[0==o.iscomment&&null!=o.is_up?s("mt-button",{staticClass:"btn_red",attrs:{size:"small"},on:{click:function(s){return t.addComm(o.product_id)}}},[t._v("评价晒单")]):t._e(),t._v(" "),1==o.iscomment&&null!=o.is_up?s("mt-button",{staticClass:"btn_default",attrs:{size:"small"}},[t._v("已评价")]):t._e()],1)])])])}),0)])]):t._e(),t._v(" "),t.imgShow?s("div",{staticClass:"pro_com_img_bg",attrs:{catchtouchmove:"ture"},on:{click:t.hiddenImg}}):t._e(),t._v(" "),t.imgShow?s("div",{staticClass:"pro_com_img",attrs:{catchtouchmove:"ture"},on:{click:t.hiddenImg}},[s("img",{attrs:{src:t.img_show_big,alt:""},on:{click:t.hiddenImg}})]):t._e(),t._v(" "),s("div",{staticClass:"avatar_model_bg",attrs:{hidden:t.hiddenUploadImg},on:{click:t.hiddenModel}}),t._v(" "),s("div",{staticClass:"avatar_model",attrs:{hidden:t.hiddenUploadImg}},[t._m(4),t._v(" "),s("div",{staticClass:"avatar_info",on:{click:t.addImg}},[s("input",{attrs:{type:"file",accept:"image/*",id:"album",name:"pic"}}),t._v(" "),s("img",{attrs:{src:t.imgPath+"com/cra.png"}}),t._v(" "),s("span",[t._v("相册")])]),t._v(" "),s("div",{staticClass:"avatar_info",on:{click:t.choseCra}},[s("img",{attrs:{src:t.imgPath+"com/cra1.png"}}),t._v(" "),s("span",[t._v("拍照")])])]),t._v(" "),t.showToast?s("div",{staticClass:"toast_model"}):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"title"},[o("i",{staticClass:"iconfont icon-shop"}),this._v(" "),o("span",[this._v("商品评分：")])])},function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"starTitle"},[o("span",[this._v("商品描述：")])])},function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"starTitle"},[o("span",[this._v("物流服务：")])])},function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"starTitle"},[o("span",[this._v("服务评价：")])])},function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"avatar_title"},[o("span",[this._v("上传图片")])])}]};var m=s("VU/8")(c,l,!1,function(t){s("xi1M")},"data-v-44794307",null);o.default=m.exports},xi1M:function(t,o){}});
//# sourceMappingURL=58.38637d24cc7ef7c53c29.js.map