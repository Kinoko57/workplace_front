webpackJsonp([53],{MEMh:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),o=s.n(i),a=s("fqE/"),r=s("Au9i"),n=s("yINb"),d=s("NYxO"),c=s("gyMJ"),l=s("WVZN"),_=s("Jtwt"),u={name:"Order",components:{commonHeader:a.a,Search:r.Search,LyTab:n.a,returnTop:_.a,InfiniteScroll:r.InfiniteScroll,Lazyload:r.Lazyload,Button:r.Button,MessageBox:r.MessageBox,Toast:r.Toast,Loadmore:r.Loadmore},data:function(){return{h_title:"我的订单",options:{activeColor:"#ff8d97",labelKey:"name"},payId:2,orderId:"",paymenId:"",active_type_id:"type0",isShow:!1,newNews:!1,total_amout:0,orderstatus:"等待付款",selectId:0,orderStatusCode:0,loading:!0,time:"",endTime:"",saleTime:{},saleTimeList:[{day:"00",hou:"00",min:"00",sec:"00"}],page:1,limit:10,orderList:[],endTimeList:[],total:0,orderNum:!1,after_tips:"",leftLength:0,allowbind:!0,imgPath:"https://share.gongzhugou.com/static/image/xcx_img/",payslots:[{defaultIndex:0,values:["微信支付","支付宝支付"]}],orderType:[{id:0,tid:0,name:"全部"},{id:1,tid:1,name:"待付款"},{id:2,tid:5,name:"待发货"},{id:3,tid:2,name:"待收货"},{id:4,tid:7,name:"退换/售后"},{id:5,tid:6,name:"待评价"},{id:6,tid:3,name:"已完成"},{id:7,tid:4,name:"已取消"}],channels:"",hiddenPay:!1,paytype:"wxPay"}},mounted:function(){r.Indicator.open("加载中..."),console.log(this.$route.params);var t=window.localStorage;void 0!==this.$route.params.id?(this.selectId=this.$route.params.id,this.orderStatusCode=this.$route.params.tid,t.setItem("selectId",this.selectId),t.setItem("orderStatusCode",this.orderStatusCode)):(this.selectId=parseInt(t.getItem("selectId")),this.orderStatusCode=parseInt(t.getItem("orderStatusCode"))),this.getList();var e=this,s=window.plus;console.log(s),void 0!=s&&s.payment.getChannels(function(t){e.channels=t},function(t){console.log("获取支付通道列表失败："+t.message)})},methods:o()({},Object(d.c)({setCarnum:"SET_CARNUM"}),{goTop:function(){console.log("回到顶部"),document.getElementById("order").scrollIntoView({block:"start",behavior:"smooth"})},goComm:function(t,e){this.$router.togo({path:"/addComment?num="+e+"&orderId="+t})},goPro:function(t,e){"7"===this.orderStatusCode?e.flag<=0?this.$router.togo({path:"/saleAfter?pid="+e.id+"&orderId="+t+"&order_type=7"}):this.$router.togo({path:"/afterDetail?pid="+e.id+"&orderId="+t}):this.$router.togo({path:"/orderDetail?id="+t})},goIndex:function(t){this.$router.replace({path:"/index"})},choseOrder:function(t){var e=window.localStorage;r.Indicator.open("加载中..."),console.log(t),this.orderStatusCode=t.tid,this.selectId=t.id,e.setItem("selectId",this.selectId),e.setItem("orderStatusCode",this.orderStatusCode),this.page=1,this.total=0,this.orderList=[],document.getElementById("order").scrollIntoView(!1),this.getList()},cancelOrders:function(t,e){var s=this,i=window.plus;window.plus?i.nativeUI.confirm("确定取消当前订单？订单一经取消不可恢复！",function(i){if(console.log("Close confirm: "+i.index),0===i.index||"0"===i.index){var o={id:t,payment_id:e};Object(c.k)(o).then(function(t){t.isSuccess?(Object(r.Toast)({message:t.msg,iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){clearInterval(s.time),s.orderList=[],s.saleTimeList=[],s.endTimeList=[],s.total=0,s.page=1,s.getList()},1e3)):Object(r.Toast)({message:t.msg,duration:1e3})})}else console.log("用户点击取消")},{title:"提示",buttons:["确定","取消"],verticalAlign:"center"}):Object(r.MessageBox)({title:"提示",message:"确定取消当前订单？订单一经取消不可恢复！",showCancelButton:!0,closeOnClickModal:!1}).then(function(i){if("confirm"===i){var o={id:t,payment_id:e};Object(c.k)(o).then(function(t){t.isSuccess?(Object(r.Toast)({message:t.msg,iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){clearInterval(s.time),s.orderList=[],s.saleTimeList=[],s.endTimeList=[],s.total=0,s.page=1,s.getList()},1e3)):Object(r.Toast)({message:t.msg,duration:1e3})})}else console.log("用户点击取消")})},getList:function(){var t=this,e={id:this.orderStatusCode,page:this.page,limit:this.limit};Object(c.B)().then(function(t){t.isSuccess&&s.setCarnum(t.data.rows_total)}),console.log(this.page);var s=this;Object(c._3)(e).then(function(e){if(r.Indicator.close(),t.isShow=!0,e.isSuccess){if(7===s.orderStatusCode&&null!=e.rows)for(var i=0;i<e.rows.length;i++){for(var o=[],a=0;a<e.rows[i].rows.length;a++)for(var n=0;n<e.rows[i].rows[a].order_items.length;n++)o.push(e.rows[i].rows[a].order_items[n].type);var d=o.join(",");-1!==d.indexOf("barter")?e.rows[i].after_type="barter":-1!==d.indexOf("reship")?e.rows[i].after_type="reship":e.rows[i].after_type="refunds"}if(1===s.orderStatusCode&&null!=e.rows){for(var c=[],_=0;_<e.rows.length;_++)c.push(e.rows[_].countdown);s.endTimeList=c;var u=Object(l.b)(c);s.saleTimeList=u,s.time=setInterval(function(){for(var t=0;t<c.length;t++)c[t]>0?c[t]=--c[t]:c[t]=0;s.endTimeList=c,u=Object(l.b)(c),s.saleTimeList=u},1e3)}e.rows.length>0?(s.orderList=e.rows,s.total=e.total,s.orderNum=!0,s.loading=!1,e.rows.length<s.limit&&(s.loading=!0)):(s.orderList=[],s.orderNum=!1,s.loading=!0)}})},loadMore:function(){this.loading=!0,this.page=++this.page;var t={id:this.orderStatusCode,page:this.page,limit:this.limit},e=this;Object(c._3)(t).then(function(t){t.isSuccess&&(t.rows.length>0?(e.orderList=e.orderList.concat(t.rows),e.total=t.total,e.orderNum=!0,e.loading=!1,t.rows.length<e.limit&&(e.loading=!0)):(e.orderNum=!1,e.loading=!0),console.log(e.orderList))})},viewtrack:function(t){var e=this;Object(c._5)(t).then(function(s){s.isSuccess?e.$router.togo({path:"/orderTrack?orderId="+t}):Object(r.Toast)({message:s.msg,duration:1e3})})},sureOrder:function(t){var e=this,s=window.plus;window.plus?s.nativeUI.confirm("请确定已收到货品！",function(s){console.log("Close confirm: "+s.index),0===s.index||"0"===s.index?Object(c.o)(t).then(function(t){t.isSuccess?(Object(r.Toast)({message:"成功",iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){e.page=1,e.orderList=[],e.getList()},1e3)):Object(r.Toast)({message:t.msg,duration:1e3})}):console.log("用户点击取消")},{title:"提示",buttons:["确定","取消"],verticalAlign:"center"}):Object(r.MessageBox)({title:"提示",message:"请确定已收到货品",showCancelButton:!0,closeOnClickModal:!1}).then(function(s){"confirm"===s?Object(c.o)(t).then(function(t){t.isSuccess?(Object(r.Toast)({message:"成功",iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){e.page=1,e.orderList=[],e.getList()},1e3)):Object(r.Toast)({message:t.msg,duration:1e3})}):console.log("用户点击取消")})},onPayChange:function(t,e){"微信支付"==e[0]?this.paytype="wxPay":this.paytype="aliPay"},hidePayModel:function(){this.hiddenPay=!1},chosePayModel:function(){console.log(this.paytype),"wxPay"==this.paytype?this.payId=2:this.payId=3,this.hiddenPay=!1,this.payOver()},showPayType:function(t,e,s){this.orderId=t,this.payId=e,this.paymenId=s,this.payId=2,this.payOver()},payOver:function(){if(this.allowbind){this.allowbind=!1;var t={};2==this.payId&&(console.log("微信支付"),t={id:this.orderId,pay_id:this.payId,payment_id:this.paymenId,pay_payment:"wechatapp"}),3==this.payId&&(console.log("支付宝支付"),t={id:this.orderId,pay_id:this.payId,payment_id:this.paymenId,pay_payment:"alipayapp"}),this.wxPayment(t)}},wxPayment:function(t){console.log("支付前传值"),console.log(t);var e=this;Object(c._46)(t).then(function(t){if(t.isSuccess){console.log(t.data),console.log("支付通道"),console.log(e.channels);var s=window.plus,i={},o=e.channels[0];2==e.payId&&(o=e.channels[0],i={appid:t.data.appId,noncestr:t.data.nonceStr,package:t.data.package,partnerid:t.data.partnerid,prepayid:t.data.prepayid,timestamp:t.data.timeStamp,sign:t.data.paySign}),3==e.payId&&(o=e.channels[1],i=t.data.orderstr),console.log("最终选择付款方式"),console.log(o),console.log(i),s.payment.request(o,i,function(){e.allowbind=!0,Object(r.Toast)({message:"支付成功",iconClass:"iconfont icon-dui1",duration:1e3}),e.$router.replace({path:"/paySuccess?addrId="+e.staticAdd[0].id})},function(t){console.log(t.message),e.allowbind=!0})}else Object(r.Toast)({message:t.msg,duration:1e3})})},remind:function(t,e){var s=this;0===e||"0"===e?Object(c._34)(t).then(function(e){e.isSuccess?(Object(r.Toast)({message:"已提醒",iconClass:"iconfont icon-dui1",duration:1e3}),setTimeout(function(){for(var e=0;e<s.orderList.length;e++)if(s.orderList[e].order_id===t){s.orderList[e].remind=1;break}},1e3)):Object(r.Toast)({message:e.msg,duration:1e3})}):Object(r.Toast)({message:"请勿重复提醒",duration:1e3})},beforeDestroy:function(){clearInterval(this.time)}}),computed:o()({},Object(d.b)([]))},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("common-header",{attrs:{h_title:t.h_title}}),t._v(" "),s("return-top",{on:{returnTop:t.goTop}}),t._v(" "),s("div",{staticStyle:{height:"0.9rem"},attrs:{id:"order"}}),t._v(" "),t.isShow?s("div",{staticClass:"myOrder"},[s("return-top",{on:{returnTop:t.goTop}}),t._v(" "),s("div",{staticClass:"order_body"},[s("ly-tab",{staticClass:"order_type",attrs:{items:t.orderType,options:t.options},on:{change:t.choseOrder},model:{value:t.selectId,callback:function(e){t.selectId=e},expression:"selectId"}}),t._v(" "),s("div",{staticStyle:{height:"0.9rem"}}),t._v(" "),s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"order_list",attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-distance":"30"}},[t._l(t.orderList,function(e,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.orderList.length>0,expression:"orderList.length>0"}],key:i,staticClass:"order_single"},[s("div",{staticClass:"order_head"},[s("div",{staticClass:"order_code"},[1==e.t_type?s("span",[t._v("订单号：")]):t._e(),t._v(" "),e.third_id>0&&1!=e.t_type?s("span",{staticClass:"order_tag"},[t._v(t._s(e.third_name))]):t._e(),t._v(" "),0==e.third_id&&1!=e.t_type?s("span",{staticClass:"order_tag"},[t._v("平台自营")]):t._e(),t._v(" "),s("span",[t._v(t._s(e.order_id))])]),t._v(" "),7!=t.orderStatusCode?s("div",{staticClass:"order_states"},[1==e.t_type&&void 0!=e.countdown&&e.countdown>0||t.endTimeList.length>0&&1==e.t_type&&e.countdown>0?s("div",[t._v("\n                等待付款")]):t._e(),t._v(" "),5==e.t_type?s("div",[t._v("买家已付款")]):t._e(),t._v(" "),2==e.t_type?s("div",[t._v("待收货")]):t._e(),t._v(" "),6==e.t_type?s("div",[t._v("交易成功")]):t._e(),t._v(" "),3==e.t_type?s("div",[t._v("交易完成")]):t._e(),t._v(" "),1==e.t_type&&t.endTimeList.length<=0&&void 0!=e.countdown&&e.countdown<=0||4==e.t_type?s("div",[t._v("\n                已取消")]):t._e()]):s("div",{staticClass:"order_states"},["refunds"==e.after_type?s("div",[t._v("退款订单")]):t._e(),t._v(" "),"reship"==e.after_type?s("div",[t._v("退货订单")]):t._e(),t._v(" "),"barter"==e.after_type?s("div",[t._v("换货订单")]):t._e()])]),t._v(" "),t._l(e.rows,function(i,o){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.rows.length>0,expression:"order.rows.length>0"}],key:o,staticClass:"order_child"},[s("div",{staticClass:"order_child_head"},[1==e.t_type?s("div",{staticClass:"order_code"},[s("span",[t._v(t._s(i.order_id))])]):t._e()]),t._v(" "),t._l(i.order_items,function(e,o){return s("div",{directives:[{name:"show",rawName:"v-show",value:i.order_items.length>0,expression:"child.order_items.length>0"}],key:o,staticClass:"order_pro_info",on:{click:function(s){return t.goPro(i.order_id,e)}}},[s("div",{staticClass:"pro_img"},[null!=e.product_img_src&&""!=e.product_img_src?s("img",{attrs:{src:e.product_img_src}}):s("img",{attrs:{src:t.imgPath+"pro/static.png"}})]),t._v(" "),s("div",{staticClass:"pro_info"},[s("div",{staticClass:"pro_title"},["tuangou"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("拼购")]):t._e(),t._v(" "),"qianggou"==i.order_refer||"qianggou"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("促销")]):t._e(),t._v(" "),"exchange"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("抽奖")]):t._e(),t._v(" "),"super"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("超级转盘")]):t._e(),t._v(" "),"try"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("试用")]):t._e(),t._v(" "),"scantry"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("扫码试用")]):t._e(),t._v(" "),"point"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("兑换")]):t._e(),t._v(" "),"birthday"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("生日兑换")]):t._e(),t._v(" "),"scan"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("扫码抽奖")]):t._e(),t._v(" "),"fruits"==i.order_refer?s("span",{staticClass:"title_icon"},[t._v("水果")]):t._e(),t._v(" "),s("span",[t._v(t._s(e.name))])]),t._v(" "),""!=e.title&&null!=e.title?s("div",{staticClass:"pro_color"},[t._v("规格："+t._s(e.title))]):t._e(),t._v(" "),s("div",{staticClass:"pro_spec"},[s("div",{staticClass:"pro_price"},[e.price>0?s("span",{staticClass:"peo_nowprice"},[t._v("￥"+t._s(e.price)+" ")]):t._e(),t._v(" "),e.point>0&&e.price>0?s("span",{staticClass:"pro_integral"},[t._v("+")]):t._e(),t._v(" "),e.point>0?s("div",{staticClass:"pro_inter_img"},[s("i",{staticClass:"iconfont icon-jifen1"})]):t._e(),t._v(" "),e.point>0?s("span",{staticClass:"pro_integral"},[t._v(t._s(e.point))]):t._e()]),t._v(" "),s("div",{staticClass:"pro_num"},[t._v("数量："+t._s(e.nums))])])])])})],2)}),t._v(" "),s("div",{staticClass:"order_info"},[t._v("\n            共"+t._s(e.goods_num)+"件商品 合计：\n            "),s("span",[t._v("￥"+t._s(e.total_price))]),t._v(" "),e.point_use>0?s("span",[t._v("+"+t._s(e.point_use)+"积分")]):t._e(),t._v("\n            （含运费￥"+t._s(e.cost_freight)+"）\n          ")]),t._v(" "),s("div",{class:1==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[1==t.orderStatusCode&&e.countdown>0?s("div",{staticClass:"countdown"},[s("i",{staticClass:"iconfont icon-jinriqianggou"}),t._v(" "),s("span",[t._v("支付剩余")]),t._v(" "),s("span",[t._v(t._s(t.saleTimeList[i].hou)+":"+t._s(t.saleTimeList[i].min)+":"+t._s(t.saleTimeList[i].sec))])]):t._e(),t._v(" "),e.countdown>0?s("mt-button",{attrs:{size:"small"},on:{click:function(s){return t.cancelOrders(e.order_id,e.payment_id)}}},[t._v("\n              取消订单")]):t._e(),t._v(" "),e.countdown>0?s("mt-button",{staticClass:"btn_red",attrs:{size:"small"},on:{click:function(s){return t.showPayType(e.order_id,e.pay_id,e.payment_id)}}},[t._v("立即支付")]):t._e(),t._v(" "),e.countdown<=0?s("mt-button",{attrs:{size:"small"}},[t._v("已取消")]):t._e()],1),t._v(" "),s("div",{class:5==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[s("mt-button",{class:1==e.remind?"":"btn_red",attrs:{size:"small"},on:{click:function(s){return t.remind(e.order_id,e.remind)}}},[t._v("提醒发货")])],1),t._v(" "),s("div",{class:2==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[s("mt-button",{attrs:{size:"small"},on:{click:function(s){return t.viewtrack(e.order_id)}}},[t._v("查看物流")]),t._v(" "),s("mt-button",{staticClass:"btn_red",attrs:{size:"small"},on:{click:function(s){return t.sureOrder(e.order_id)}}},[t._v("确认收货")])],1),t._v(" "),s("div",{class:6==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[s("mt-button",{attrs:{size:"small"},on:{click:function(s){return t.viewtrack(e.order_id)}}},[t._v("查看物流")]),t._v(" "),s("mt-button",{staticClass:"btn_red",attrs:{size:"small"},on:{click:function(s){return t.goComm(e.order_id,e.goods_num)}}},[t._v("立即评价\n            ")])],1),t._v(" "),s("div",{class:3==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[s("mt-button",{attrs:{size:"small"},on:{click:function(s){return t.viewtrack(e.order_id)}}},[t._v("查看物流")])],1),t._v(" "),s("div",{class:4==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[s("mt-button",{attrs:{size:"small"}},[t._v("已取消")])],1),t._v(" "),s("div",{class:7==e.t_type&&7!=t.orderStatusCode?"order_oper":"view_hidden"},[s("mt-button",{attrs:{size:"small"}},[t._v("售后完成")])],1)],2)}),t._v(" "),0==t.total?s("div",{staticClass:"order_list_null"},[s("span",[t._v("当前类别下暂无订单，快去选购吧~")]),t._v(" "),s("mt-button",{staticClass:"btn_red",on:{click:t.goIndex}},[t._v("去首页看看")])],1):t._e(),t._v(" "),t.loading?t._e():s("div",{staticClass:"more_load"},[s("mt-spinner",{attrs:{type:"fading-circle"}})],1),t._v(" "),t.orderList.length==t.total&&t.loading?s("div",{staticClass:"list_bottom"},[t._v("—————— 我是有底线的 ——————")]):t._e()],2)],1)],1):t._e(),t._v(" "),t.hiddenPay?s("div",{staticClass:"model_pay_bg",on:{click:t.hidePayModel}}):t._e(),t._v(" "),t.hiddenPay?s("div",{staticClass:"model_pay"},[s("div",{staticClass:"model_head"},[s("span",{on:{click:t.hidePayModel}},[t._v("取消")]),t._v(" "),s("span",{on:{click:t.chosePayModel}},[t._v("确认")])]),t._v(" "),s("div",{staticClass:"model_picker"},[s("mt-picker",{attrs:{slots:t.payslots},on:{change:t.onPayChange}})],1)]):t._e()],1)},staticRenderFns:[]};var v=s("VU/8")(u,p,!1,function(t){s("ULe7")},"data-v-438a3ed7",null);e.default=v.exports},ULe7:function(t,e){}});
//# sourceMappingURL=53.5f2edc3914432e3a5926.js.map