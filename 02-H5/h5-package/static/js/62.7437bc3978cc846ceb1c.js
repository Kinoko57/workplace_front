webpackJsonp([62],{SQzM:function(o,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("Dd8w"),c=e.n(s),i=e("fqE/"),d=e("Au9i"),u=e("gyMJ"),a=e("NYxO"),n=e("WVZN"),h={name:"UseCoupon",components:{commonHeader:i.a,InfiniteScroll:d.InfiniteScroll,Indicator:d.Indicator,Button:d.Button,Lazyload:d.Lazyload,Toast:d.Toast},data:function(){return{imgPath:"https://share.gongzhugou.com/static/image/xcx_img/",h_title:"使用优惠券",couList:[],couUseList:[],couNoList:[],staticAdd:[],couValue:0,choseId:0,cou_id:0,couId:0,choseType:0,isChecked:!1,pid:"",couCode:"",default_code:"",default_cou:"",ship_id:"",addType:"",orderType:"",chooseAdd:"",couRevise:"",addRevise:""}},mounted:function(){},activated:function(){document.getElementById("top").scrollIntoView(!1);var o=this.$route.query,t=this.$store.state.home.choseAddr;console.log(t),this.choseType=0,this.default_cou=t.default_cou,this.ship_id=t.ship_id,this.addType=t.addType,this.orderType=t.orderType,this.staticAdd=t.staticAdd,this.chooseAdd=t.chooseAdd,this.couInfo=t.couInfo,this.couCode=t.couCode,this.couRevise=t.couisrevise,this.addRevise=t.addisRevise,this.couId=t.couId,this.pid=o.pid;var e=t.couList;this.couUseList=[],this.notUseList=[],console.log(e),null==e&&(e=[]),console.log("所有优惠券"),console.log(e);for(var s=0;s<e.length;s++)-1===e[s].totime.indexOf("-")&&(e[s].totime=Object(n.c)(e[s].totime,"{y}-{m}-{d}")),void 0===e[s].checked||"true"!==e[s].checked&&!0!==e[s].checked?e[s].checked=!1:(this.default_code=e[s].code,this.couValue=e[s].cashworth,this.isChecked=!0,this.choseId=e[s].code,this.cou_id=e[s].id,e[s].checked=!0);for(var c=[],i=[],d=0;d<e.length;d++)void 0!=e[d].can_use&&1==e[d].can_use?c.push(e[d]):i.push(e[d]);console.log(),this.couList=c,this.couUseList=c,this.couNoList=i,this.pid=o.pid,console.log("可使用优惠券"),console.log(this.couUseList),console.log("不可使用优惠券"),console.log(this.couNoList)},methods:c()({},Object(a.c)({setChoseAddr:"SET_CHOSEADDR",setUserInfo:"SET_USERINFO"}),{goTop:function(){console.log("回到顶部"),document.getElementById("coll").scrollIntoView({block:"start",behavior:"smooth"})},choseTypeList:function(o){this.couList=0===o?this.couUseList:this.couNoList,this.choseType=o},choseCou:function(o){var t=this;if(o.checked=!o.checked,console.log(o),o.checked){for(var e=0;e<this.couList.length;e++)this.couList[e].checked=!1,this.couList[e].id===o.id&&(this.couList[e].checked=!0,this.couValue=this.couList[e].cashworth,this.isChecked=!0,this.choseId=this.couList[e].code);this.cou_id=o.id,this.default_code=o.code,this.$forceUpdate(function(){t.couUseList=t.couList})}else{for(var s=0;s<this.couList.length;s++)this.couList[s].checked=!1,this.couList[s].id===o.id&&(this.couList[s].checked=!1,this.couValue=0,this.isChecked=!1);this.choseId="",this.cou_id="",this.default_code="",this.$forceUpdate(function(){t.couUseList=t.couList})}console.log(this.couUseList)},useCou:function(){var o=this,t="";if(o.staticAdd.length>0&&(t=o.staticAdd[0].id),""===o.choseId){-1!==o.default_cou.indexOf("c=")&&(o.default_cou=o.default_cou.substring(2));var e={coupon_id:o.cou_id,coupon_code:o.default_cou,checked:o.pid,cart_type:o.addType,shipmethod_id:o.ship_id,type:o.orderType,address_id:t};Object(u.j)(e).then(function(t){if(t.isSuccess){var e={couisrevise:!1,chooseAdd:"",couInfo:"",couValue:"",couCode:"",amount:"",couList:[],static_freight:"",staticAdd:[]};o.setChoseAddr(e),e.amount=t.amount;var s="";s=""===o.choseId?"选择优惠券":"已减"+t.coupon_discount+"元",void 0!==t.amount?e.amount=t.amount:e.amount=o.amount,e.couInfo=s,e.couisrevise=!0,e.addisRevise=o.addRevise,e.chooseAdd=o.chooseAdd,e.staticAdd=o.staticAdd,e.couValue=t.coupon_discount,e.couCode=t.cart_params,e.couId=t.coupon_id,e.couList=o.couList.concat(o.couNoList),e.static_freight=t.cost_freight,console.log(e.couList),o.setChoseAddr(e),window.localStorage.setItem("neworder",!1),o.$router.go(-1)}})}else{var s={coupon_id:o.cou_id,coupon_code:o.choseId,checked:o.pid,shipmethod_id:o.ship_id,cart_type:o.addType,type:o.orderType,address_id:t};Object(u._10)(s).then(function(t){if(t.isSuccess){var e={couisrevise:!1,chooseAdd:"",couInfo:"",couValue:"",couCode:"",amount:"",couList:[],static_freight:"",staticAdd:[]};o.setChoseAddr(e),e.amount=t.amount;var s="";s=""===o.choseId?"选择优惠券":"已减"+t.coupon_discount+"元",void 0!==t.amount?e.amount=t.amount:e.amount=o.amount,console.log(s),e.couInfo=s,e.couisrevise=!0,e.addisRevise=o.addRevise,e.chooseAdd=o.chooseAdd,e.staticAdd=o.staticAdd,e.couValue=t.coupon_discount,e.couCode=t.cart_params,e.couId=t.coupon_id,e.couList=o.couList.concat(o.couNoList),console.log(e.couList),e.static_freight=t.cost_freight,o.setChoseAddr(e),window.localStorage.setItem("neworder",!1),o.$router.go(-1)}})}},goBack:function(){this.$router.goBack()}}),computed:c()({},Object(a.b)([]))},r={render:function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("div",[e("common-header",{attrs:{h_title:o.h_title,showback:!0}}),o._v(" "),e("return-top",{on:{returnTop:o.goTop}}),o._v(" "),e("div",{staticStyle:{height:"0.9rem"},attrs:{id:"top"}}),o._v(" "),e("div",{staticClass:"use_coupon"},[e("div",{staticClass:"coupon_body"},[e("div",{staticClass:"coupon_nav"},[e("span",{class:0==o.choseType?"text_active":"",attrs:{id:"0"},on:{click:function(t){return o.choseTypeList(0)}}},[o._v("可用优惠券("+o._s(o.couUseList.length)+")")]),o._v(" "),e("span",{class:1==o.choseType?"text_active":"",attrs:{id:"1"},on:{click:function(t){return o.choseTypeList(1)}}},[o._v("不可使用优惠券("+o._s(o.couNoList.length)+")")])]),o._v(" "),o.isChecked?e("div",{staticClass:"cou_tip"},[o._v("\n        使用优惠券1张，共抵用\n        "),e("span",[o._v("￥"+o._s(o.couValue))])]):o._e(),o._v(" "),e("div",{staticClass:"cou_list"},o._l(o.couList,function(t,s){return e("div",{key:s,staticClass:"cou_info"},[0==o.choseType?e("img",{attrs:{src:o.imgPath+"order/cop_bg.png"}}):o._e(),o._v(" "),1==o.choseType?e("img",{attrs:{src:o.imgPath+"order/cop_bg_01.png"}}):o._e(),o._v(" "),e("div",{staticClass:"cou_more"},[e("div",{staticClass:"cou_value"},[o._v("￥\n              "),e("span",[o._v(o._s(t.cashworth))])]),o._v(" "),e("div",{staticClass:"cou_more_tips"},[t.order_price>0?e("span",[o._v("满"+o._s(t.order_price)+"可用")]):e("span",[o._v("无门槛通用")])])]),o._v(" "),e("div",{staticClass:"cou_tips"},[e("span",{staticClass:"cou_title"},[o._v(o._s(t.title))]),o._v(" "),e("div",{staticClass:"cou_time"},[o._v("有效期至"+o._s(t.totime))]),o._v(" "),null!=t.name?e("span",{staticClass:"cou_type"},[o._v("适用于"+o._s(t.name)+o._s(t.content))]):o._e(),o._v(" "),null==t.name?e("span",{staticClass:"cou_type"},[o._v("全类目通用"+o._s(t.content))]):o._e()]),o._v(" "),e("div",{staticClass:"cou_radio",attrs:{hidden:1==o.choseType}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.checked,expression:"item.checked"}],attrs:{id:t.id,type:"checkbox"},domProps:{checked:t.checked,checked:Array.isArray(t.checked)?o._i(t.checked,null)>-1:t.checked},on:{click:function(e){return o.choseCou(t)},change:function(e){var s=t.checked,c=e.target,i=!!c.checked;if(Array.isArray(s)){var d=o._i(s,null);c.checked?d<0&&o.$set(t,"checked",s.concat([null])):d>-1&&o.$set(t,"checked",s.slice(0,d).concat(s.slice(d+1)))}else o.$set(t,"checked",i)}}}),o._v(" "),e("label",{attrs:{for:t.id}})])])}),0)]),o._v(" "),e("div",{staticClass:"null_view"}),o._v(" "),0==o.choseType&&o.couUseList.length>0?e("div",{staticClass:"cou_btn",on:{click:o.useCou}},[e("mt-button",{attrs:{size:"normal"}},[o._v("确定")])],1):o._e(),o._v(" "),0==o.couUseList.length||1==o.choseType?e("div",{staticClass:"cou_btn",on:{click:o.goBack}},[e("mt-button",{attrs:{size:"normal"}},[o._v("返回")])],1):o._e()])],1)},staticRenderFns:[]};var l=e("VU/8")(h,r,!1,function(o){e("TjCq")},"data-v-36617de4",null);t.default=l.exports},TjCq:function(o,t){}});
//# sourceMappingURL=62.7437bc3978cc846ceb1c.js.map